<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ðŸŽŒ Anime Inventory</title>
    <link rel="stylesheet" href="style.css">
    <script src="tree.js" defer></script>
</head>
<body>
    <h1>ðŸŽŒ Anime Inventory</h1>

    <!-- Search bar -->
    <input type="text" id="search-box" placeholder="Search anime..." />
    <button id="search-btn">Search</button>

    <!-- Control buttons -->
    <button id="show-tree-btn">Show Tree</button>
    <button id="export-btn">Export CSV</button>
    <button id="rescan-btn">Rescan</button>

    <div id="results"></div>

    <script>
        document.getElementById('show-tree-btn').addEventListener('click', () => {
            fetch('/api/tree')
                .then(r => r.json())
                .then(data => {
                    const resultsDiv = document.getElementById('results');
                    resultsDiv.innerHTML = "";
                    renderTree(data, resultsDiv);
                });
        });

        document.getElementById('export-btn').addEventListener('click', () => {
            window.location.href = '/api/export_csv';
        });

        document.getElementById('rescan-btn').addEventListener('click', () => {
            fetch('/api/rescan', { method: 'POST' })
                .then(r => r.json())
                .then(data => alert(data.status));
        });

        document.getElementById('search-btn').addEventListener('click', () => {
            const query = document.getElementById('search-box').value.trim();
            if (!query) return;

            fetch(`/api/search?q=${encodeURIComponent(query)}`)
                .then(r => r.json())
                .then(data => {
                    const resultsDiv = document.getElementById('results');
                    resultsDiv.innerHTML = "";
                    if (data.length === 0) {
                        resultsDiv.innerHTML = "<p>No results found.</p>";
                        return;
                    }
                    data.forEach(item => {
                        const p = document.createElement('p');
                        p.textContent = `${item.name} â€” ${item.path}`;
                        resultsDiv.appendChild(p);
                    });
                });
        });
    </script>
</body>
</html>
